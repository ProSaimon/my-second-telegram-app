<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–æ - –ò–≥—Ä–∞ –≤ Telegram</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #8B4513, #D2691E);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-size: 28px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .game-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .scores {
            display: flex;
            justify-content: space-around;
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
        }

        .current-player {
            font-size: 20px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
        }

        .board-container {
            background: #DEB887;
            border: 3px solid #8B4513;
            border-radius: 5px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        #gameBoard {
            background: #DEB887;
            display: block;
            margin: 0 auto;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, #8B4513, #A0522D);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 12px 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .message {
            background: rgba(255, 255, 255, 0.9);
            color: #8B4513;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
            font-weight: bold;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .black { color: #000; }
        .white { color: #fff; text-shadow: 1px 1px 2px #000; }

        @media (max-width: 600px) {
            #gameBoard {
                width: 100%;
                height: auto;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé≤ –ò–≥—Ä–∞ –ì–æ</h1>
        
        <div class="game-info">
            <div class="scores">
                <div class="black">‚ö´ –ß–µ—Ä–Ω—ã–µ: <span id="blackScore">0</span></div>
                <div class="white">‚ö™ –ë–µ–ª—ã–µ: <span id="whiteScore">0</span></div>
            </div>
            
            <div class="current-player" id="currentPlayer">
                –°–µ–π—á–∞—Å —Ö–æ–¥—è—Ç: ‚ö´ –ß–µ—Ä–Ω—ã–µ
            </div>
        </div>

        <div class="message" id="gameMessage">
            –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –¥–æ—Å–∫—É, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥
        </div>

        <div class="board-container">
            <canvas id="gameBoard" width="570" height="570"></canvas>
        </div>

        <div class="controls">
            <button onclick="passTurn()">–ü–∞—Å</button>
            <button onclick="resetGame()">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
            <button onclick="undoMove()">–û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏–≥—Ä—ã
        const BOARD_SIZE = 19;
        const CELL_SIZE = 30;
        const STONE_RADIUS = 13;

        // –ò–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
        let gameState = {
            board: [],
            currentPlayer: 'B', // B - —á–µ—Ä–Ω—ã–µ, W - –±–µ–ª—ã–µ
            blackScore: 0,
            whiteScore: 0,
            moveHistory: [],
            koParam: { active: false, x: -1, y: -1 },
            gameActive: true
        };

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const canvas = document.getElementById('gameBoard');
        const ctx = canvas.getContext('2d');
        const blackScoreElement = document.getElementById('blackScore');
        const whiteScoreElement = document.getElementById('whiteScore');
        const currentPlayerElement = document.getElementById('currentPlayer');
        const gameMessageElement = document.getElementById('gameMessage');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            // –°–æ–∑–¥–∞–µ–º –ø—É—Å—Ç—É—é –¥–æ—Å–∫—É
            gameState.board = [];
            for (let i = 0; i < BOARD_SIZE; i++) {
                gameState.board[i] = [];
                for (let j = 0; j < BOARD_SIZE; j++) {
                    gameState.board[i][j] = '-';
                }
            }
            
            gameState.currentPlayer = 'B';
            gameState.blackScore = 0;
            gameState.whiteScore = 0;
            gameState.moveHistory = [];
            gameState.koParam = { active: false, x: -1, y: -1 };
            gameState.gameActive = true;
            
            updateUI();
            drawBoard();
            showMessage('–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –•–æ–¥—è—Ç ‚ö´ –ß–µ—Ä–Ω—ã–µ');
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Å–∫–∏
        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Ñ–æ–Ω
            ctx.fillStyle = '#DEB887';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // –†–∏—Å—É–µ–º —Å–µ—Ç–∫—É
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 1;
            
            for (let i = 0; i < BOARD_SIZE; i++) {
                // –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
                ctx.beginPath();
                ctx.moveTo(CELL_SIZE / 2, i * CELL_SIZE + CELL_SIZE / 2);
                ctx.lineTo(canvas.width - CELL_SIZE / 2, i * CELL_SIZE + CELL_SIZE / 2);
                ctx.stroke();
                
                // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
                ctx.beginPath();
                ctx.moveTo(i * CELL_SIZE + CELL_SIZE / 2, CELL_SIZE / 2);
                ctx.lineTo(i * CELL_SIZE + CELL_SIZE / 2, canvas.height - CELL_SIZE / 2);
                ctx.stroke();
            }
            
            // –†–∏—Å—É–µ–º —Ç–æ—á–∫–∏ (—Ö–æ—Å–∏)
            const starPoints = [3, 9, 15];
            ctx.fillStyle = '#000';
            starPoints.forEach(i => {
                starPoints.forEach(j => {
                    ctx.beginPath();
                    ctx.arc(
                        i * CELL_SIZE + CELL_SIZE / 2,
                        j * CELL_SIZE + CELL_SIZE / 2,
                        3, 0, Math.PI * 2
                    );
                    ctx.fill();
                });
            });
            
            // –†–∏—Å—É–µ–º –∫–∞–º–Ω–∏
            for (let i = 0; i < BOARD_SIZE; i++) {
                for (let j = 0; j < BOARD_SIZE; j++) {
                    if (gameState.board[i][j] !== '-') {
                        drawStone(i, j, gameState.board[i][j]);
                    }
                }
            }
        }

        // –†–∏—Å—É–µ–º –∫–∞–º–µ–Ω—å
        function drawStone(x, y, color) {
            const centerX = y * CELL_SIZE + CELL_SIZE / 2;
            const centerY = x * CELL_SIZE + CELL_SIZE / 2;
            
            if (color === 'B') {
                // –ß–µ—Ä–Ω—ã–π –∫–∞–º–µ–Ω—å —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                const gradient = ctx.createRadialGradient(
                    centerX - 3, centerY - 3, 1,
                    centerX, centerY, STONE_RADIUS
                );
                gradient.addColorStop(0, '#666');
                gradient.addColorStop(1, '#000');
                ctx.fillStyle = gradient;
            } else {
                // –ë–µ–ª—ã–π –∫–∞–º–µ–Ω—å —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º
                const gradient = ctx.createRadialGradient(
                    centerX - 2, centerY - 2, 1,
                    centerX, centerY, STONE_RADIUS
                );
                gradient.addColorStop(0, '#fff');
                gradient.addColorStop(1, '#ddd');
                ctx.fillStyle = gradient;
            }
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, STONE_RADIUS, 0, Math.PI * 2);
            ctx.fill();
            
            // –û–±–≤–æ–¥–∫–∞ –¥–ª—è –±–µ–ª—ã—Ö –∫–∞–º–Ω–µ–π
            if (color === 'W') {
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 1;
                ctx.stroke();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –¥–æ—Å–∫–µ
        canvas.addEventListener('click', (event) => {
            if (!gameState.gameActive) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –∏–Ω–¥–µ–∫—Å—ã –¥–æ—Å–∫–∏
            const boardX = Math.floor(y / CELL_SIZE);
            const boardY = Math.floor(x / CELL_SIZE);
            
            if (boardX >= 0 && boardX < BOARD_SIZE && boardY >= 0 && boardY < BOARD_SIZE) {
                makeMove(boardX, boardY);
            }
        });

        // –°–¥–µ–ª–∞—Ç—å —Ö–æ–¥
        function makeMove(x, y) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–µ—Ç–∫–∞ —Å–≤–æ–±–æ–¥–Ω–∞
            if (gameState.board[x][y] !== '-') {
                showMessage('–≠—Ç–∞ –∫–ª–µ—Ç–∫–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞!');
                return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ —Ö–æ–¥–∞ –¥–ª—è –æ—Ç–º–µ–Ω—ã
            const boardBeforeMove = JSON.parse(JSON.stringify(gameState.board));
            
            // –°—Ç–∞–≤–∏–º –∫–∞–º–µ–Ω—å
            gameState.board[x][y] = gameState.currentPlayer;
            
            // –õ–æ–≥–∏–∫–∞ –∑–∞—Ö–≤–∞—Ç–∞ –∫–∞–º–Ω–µ–π (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
            const capturedStones = checkCaptures(x, y);
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö–æ–¥
            if (capturedStones === 0 && isSuicideMove(x, y)) {
                gameState.board[x][y] = '-';
                showMessage('–°–∞–º–æ—É–±–∏–π—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö–æ–¥!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ (—É–ø—Ä–æ—â–µ–Ω–Ω–æ)
            if (capturedStones === 1 && gameState.koParam.active) {
                if (gameState.board[gameState.koParam.x][gameState.koParam.y] === '-') {
                    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                    gameState.board = boardBeforeMove;
                    showMessage('–•–æ–¥ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∞–≤–∏–ª–æ –∫–æ!');
                    return;
                }
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
            if (gameState.currentPlayer === 'B') {
                gameState.blackScore += capturedStones;
            } else {
                gameState.whiteScore += capturedStones;
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∫–æ
            if (capturedStones === 1) {
                gameState.koParam = { active: true, x: x, y: y };
            } else {
                gameState.koParam = { active: false, x: -1, y: -1 };
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ö–æ–¥ –≤ –∏—Å—Ç–æ—Ä–∏—é
            gameState.moveHistory.push({
                board: boardBeforeMove,
                player: gameState.currentPlayer,
                x: x,
                y: y,
                captures: capturedStones
            });
            
            // –ú–µ–Ω—è–µ–º –∏–≥—Ä–æ–∫–∞
            gameState.currentPlayer = gameState.currentPlayer === 'B' ? 'W' : 'B';
            
            updateUI();
            drawBoard();
            showMessage(`–•–æ–¥ —Å–¥–µ–ª–∞–Ω! –°–µ–π—á–∞—Å —Ö–æ–¥—è—Ç: ${gameState.currentPlayer === 'B' ? '‚ö´ –ß–µ—Ä–Ω—ã–µ' : '‚ö™ –ë–µ–ª—ã–µ'}`);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—Ö–≤–∞—Ç–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
        function checkCaptures(x, y) {
            let captures = 0;
            const opponent = gameState.currentPlayer === 'B' ? 'W' : 'B';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å–µ–¥–Ω–∏–µ –∫–∞–º–Ω–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            const directions = [[-1,0], [1,0], [0,-1], [0,1]];
            
            directions.forEach(([dx, dy]) => {
                const nx = x + dx;
                const ny = y + dy;
                
                if (nx >= 0 && nx < BOARD_SIZE && ny >= 0 && ny < BOARD_SIZE) {
                    if (gameState.board[nx][ny] === opponent) {
                        if (isGroupCaptured(nx, ny)) {
                            captures += removeGroup(nx, ny);
                        }
                    }
                }
            });
            
            return captures;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞—Ö–≤–∞—á–µ–Ω–∞ –ª–∏ –≥—Ä—É–ø–ø–∞
        function isGroupCaptured(startX, startY) {
            const visited = new Set();
            const stack = [[startX, startY]];
            const color = gameState.board[startX][startY];
            
            while (stack.length > 0) {
                const [x, y] = stack.pop();
                const key = `${x},${y}`;
                
                if (visited.has(key)) continue;
                visited.add(key);
                
                // –ï—Å–ª–∏ —É –∫–∞–º–Ω—è –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–∞, –≥—Ä—É–ø–ø–∞ –Ω–µ –∑–∞—Ö–≤–∞—á–µ–Ω–∞
                const neighbors = [[-1,0], [1,0], [0,-1], [0,1]];
                for (const [dx, dy] of neighbors) {
                    const nx = x + dx;
                    const ny = y + dy;
                    
                    if (nx >= 0 && nx < BOARD_SIZE && ny >= 0 && ny < BOARD_SIZE) {
                        if (gameState.board[nx][ny] === '-') {
                            return false; // –ï—Å—Ç—å —Å–≤–æ–±–æ–¥–∞
                        }
                        if (gameState.board[nx][ny] === color) {
                            stack.push([nx, ny]);
                        }
                    }
                }
            }
            
            return true; // –ì—Ä—É–ø–ø–∞ –∑–∞—Ö–≤–∞—á–µ–Ω–∞
        }

        // –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω–æ–π –≥—Ä—É–ø–ø—ã
        function removeGroup(startX, startY) {
            const color = gameState.board[startX][startY];
            const stack = [[startX, startY]];
            let count = 0;
            
            while (stack.length > 0) {
                const [x, y] = stack.pop();
                
                if (gameState.board[x][y] !== color) continue;
                
                gameState.board[x][y] = '-';
                count++;
                
                const neighbors = [[-1,0], [1,0], [0,-1], [0,1]];
                for (const [dx, dy] of neighbors) {
                    const nx = x + dx;
                    const ny = y + dy;
                    
                    if (nx >= 0 && nx < BOARD_SIZE && ny >= 0 && ny < BOARD_SIZE) {
                        if (gameState.board[nx][ny] === color) {
                            stack.push([nx, ny]);
                        }
                    }
                }
            }
            
            return count;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∞–º–æ—É–±–∏–π—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö–æ–¥
        function isSuicideMove(x, y) {
            // –í—Ä–µ–º–µ–Ω–Ω–æ —Å—Ç–∞–≤–∏–º –∫–∞–º–µ–Ω—å
            gameState.board[x][y] = gameState.currentPlayer;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∏–º–µ–µ—Ç –ª–∏ –≥—Ä—É–ø–ø–∞ —Å–≤–æ–±–æ–¥—ã
            const hasLiberties = !isGroupCaptured(x, y);
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –±—ã–ª–æ
            gameState.board[x][y] = '-';
            
            return !hasLiberties;
        }

        // –ü–∞—Å
        function passTurn() {
            if (!gameState.gameActive) return;
            
            gameState.moveHistory.push({
                board: JSON.parse(JSON.stringify(gameState.board)),
                player: gameState.currentPlayer,
                x: -1,
                y: -1,
                captures: 0,
                pass: true
            });
            
            gameState.currentPlayer = gameState.currentPlayer === 'B' ? 'W' : 'B';
            updateUI();
            showMessage(`–ò–≥—Ä–æ–∫ –ø—Ä–æ–ø—É—Å—Ç–∏–ª —Ö–æ–¥. –°–µ–π—á–∞—Å: ${gameState.currentPlayer === 'B' ? '‚ö´ –ß–µ—Ä–Ω—ã–µ' : '‚ö™ –ë–µ–ª—ã–µ'}`);
        }

        // –û—Ç–º–µ–Ω–∏—Ç—å —Ö–æ–¥
        function undoMove() {
            if (gameState.moveHistory.length === 0) {
                showMessage('–ù–µ—á–µ–≥–æ –æ—Ç–º–µ–Ω—è—Ç—å!');
                return;
            }
            
            const lastMove = gameState.moveHistory.pop();
            gameState.board = lastMove.board;
            gameState.currentPlayer = lastMove.player;
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—á–∫–∏, –µ—Å–ª–∏ –±—ã–ª–∏ –∑–∞—Ö–≤–∞—Ç—ã
            if (lastMove.captures > 0) {
                if (lastMove.player === 'B') {
                    gameState.blackScore -= lastMove.captures;
                } else {
                    gameState.whiteScore -= lastMove.captures;
                }
            }
            
            updateUI();
            drawBoard();
            showMessage('–•–æ–¥ –æ—Ç–º–µ–Ω–µ–Ω');
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        function updateUI() {
            blackScoreElement.textContent = gameState.blackScore;
            whiteScoreElement.textContent = gameState.whiteScore;
            
            currentPlayerElement.textContent = `–°–µ–π—á–∞—Å —Ö–æ–¥—è—Ç: ${
                gameState.currentPlayer === 'B' ? '‚ö´ –ß–µ—Ä–Ω—ã–µ' : '‚ö™ –ë–µ–ª—ã–µ'
            }`;
            
            currentPlayerElement.className = `current-player ${
                gameState.currentPlayer === 'B' ? 'black' : 'white'
            }`;
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
        function showMessage(message) {
            gameMessageElement.textContent = message;
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            initGame();
        };
    </script>
</body>
</html>